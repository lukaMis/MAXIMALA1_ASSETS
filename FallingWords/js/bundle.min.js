"use strict";var FallingWords={};FallingWords.CURRENT_ID=0,FallingWords.MAX_Y_POSITION=755,FallingWords.PARTICLE_MAX_OFFSET=150,FallingWords.AUDIO_IS_MUTED=!1,FallingWords.ROTATION_MODIFIER_COEFFICIENT=.6,FallingWords.GAME_TIME_IN_SECONDS=60,FallingWords.NEW_QUESTION_TIMER_IN_SECONDS=10,FallingWords.SPAWN_TIME_IN_SECONDS=1.35,FallingWords.ANSWER_FALL_TIME=19,FallingWords.MAX_ROTATION=20,FallingWords.CORRECT_SPAWN_PERCENT=50,FallingWords.CORRECT_ANSWER_POINTS=10,FallingWords.WRONG_ANSWER_POINTS=10,FallingWords.EASING_FUNCTION_TO_USE="linear",FallingWords.getPercentChance=function(n){return!(Math.floor(100*Math.random())>n)},FallingWords.getRandomIntInRange=function(n,t){return Math.floor(Math.random()*(t-n+1))+n},FallingWords.getRandomInRange=function(n,t){return Math.random()*(t-n)+n},FallingWords.removePreloader=function(){$("body").removeClass("loading")},FallingWords.ThemeControler=function(n){var t={};(function(){$("#wrapper").attr({"data-theme":n.theme})})();return t.init=function(){},t},FallingWords.DataHandler=function(){var n={};return n.init=function(){},n.getTitleData=function(){return i18n.t("titleView",{returnObjectTrees:!0})},n.getGameData=function(){return i18n.t("gameData",{returnObjectTrees:!0})},n.getFeedbackData=function(){return i18n.t("feedbackView",{returnObjectTrees:!0})},n.getGameViewData=function(){return i18n.t("gameView",{returnObjectTrees:!0})},n.getAudioData=function(){return i18n.t("audioData",{returnObjectTrees:!0})},n},FallingWords.TitleView=function(n){var t={};t.data=n.data;var e=function(){var n='\n    <div id="titleView" class="view">\n      <div class="viewContent">\n        <p class="annotation">'+t.data.text+'</p>\n        <div class="button">\n          <p>'+t.data.button+"</p>\n        </div>\n      </div>\n    </div>\n    ";$("#contentWrapper").append(n),$("#contentWrapper #titleView .button").one("click",i)},i=function(){$(t).trigger("onTitleViewClicked"),$("#contentWrapper #titleView").remove()};return t.init=function(){e()},t},FallingWords.FeedbackView=function(n){var t={},e=n.data,i=function(n){var t=e.text;t=t.replace("***","<span>"+n+"</span>");var i='\n    <div id="feedbackView" class="view">\n      <div class="viewContent">\n        <p class="annotation">'+t+'</p>\n        <div class="button">\n          <p>'+e.button+"</p>\n        </div>\n      </div>\n    </div>\n    ";$("#contentWrapper").append(i),$("#contentWrapper #feedbackView .button").one("click",a)},a=function(){$("#contentWrapper #feedbackView").remove(),$(t).trigger("onFeedbackViewClicked")};return t.init=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;i(n)},t},FallingWords.InfoBar=function(n){var t={},e=n.data,i=0,a=void 0,o=0,r=function(){var n='\n      <div id="infoBar">\n        <p id="time">\n          <span id="m">00</span>:<span id="s">00</span>\n        </p>\n        <div id="muteButton" data-mute="'+FallingWords.AUDIO_IS_MUTED+'"></div>\n        <p id="question">QUESTION</p>\n        <p id="score"><span id="pointsInt">0</span> <span>'+e.points+"</span></p>\n      </div>\n      ";$("#contentWrapper").append(n),setTimeout(function(){I()},50)},l=function(n){document.getElementById("question").innerHTML=n.question,document.getElementById("question").style.color=n.color||"#000"},s=function(n){$("#score #pointsInt").text(n.score).attr({"data-increment":"","data-score":n.increment?FallingWords.CORRECT_ANSWER_POINTS:FallingWords.WRONG_ANSWER_POINTS}),setTimeout(function(){$("#score #pointsInt").attr({"data-increment":!!n.increment})},50)},d=function(){o+=FallingWords.CORRECT_ANSWER_POINTS,s({score:o,increment:!0})},c=function(){o-=FallingWords.WRONG_ANSWER_POINTS,o=o<0?0:o,s({score:o,decrement:!0})},u=function(){return o},g=function(){a=setInterval(function(){f()},1e3),f()},f=function(){i<FallingWords.GAME_TIME_IN_SECONDS+1?(m(i),i++):(p(),$(t).trigger("onEndOfTime"))},p=function(){clearInterval(a),i=0},m=function(n){var t=(FallingWords.GAME_TIME_IN_SECONDS-n)%60,e=Math.floor((FallingWords.GAME_TIME_IN_SECONDS-n)/60);t="0"+t;var i=t.slice(-2);e="0"+e;var a=e.slice(-2),o='<span id="m">'+a+'</span>:<span id="s">'+i+"</span>";document.getElementById("time").innerHTML=o},W=function(){FallingWords.AUDIO_IS_MUTED=!FallingWords.AUDIO_IS_MUTED,$(t).trigger("onAudioMute",{muteAudio:FallingWords.AUDIO_IS_MUTED}),$("#muteButton").attr({"data-mute":FallingWords.AUDIO_IS_MUTED})},I=function(){$("#muteButton").on("click",W)},F=function(){$("#muteButton").off("click",W)},T=function(){i=0,o=0,F(),s({score:o}),$("#contentWrapper #infoBar").remove()};return t.init=function(){r(),g()},t.setQuestion=function(n){l(n)},t.incrementScore=function(){d()},t.decrementScore=function(){c()},t.getScore=function(){return u()},t.reset=function(){T()},t},FallingWords.SpawnControl=function(n){var t={},e=n.data,i=[],a=[],o=void 0,r=function(){return l(),FallingWords.CURRENT_ID=FallingWords.getRandomIntInRange(0,e.length-1),s(),e[FallingWords.CURRENT_ID].question},l=function(){i.length=0,a.length=0},s=function(){for(var n=0;n<e[FallingWords.CURRENT_ID].answers.length;n++)i.push(e[FallingWords.CURRENT_ID].answers[n]);for(var t=0;t<e.length;t++)if(t!==FallingWords.CURRENT_ID)for(var o=0;o<e[t].answers.length;o++)a.push(e[t].answers[o])},d=function(){return e[FallingWords.CURRENT_ID].answers},c=function(){f()},u=function(){clearTimeout(o),g()},g=function(){$("#gameView .answer").each(function(n,t){W($(t))})},f=function n(){var e="",r=0;FallingWords.getPercentChance(FallingWords.CORRECT_SPAWN_PERCENT)?(e=i[FallingWords.getRandomIntInRange(0,i.length-1)],r=FallingWords.CURRENT_ID):(e=a[FallingWords.getRandomIntInRange(0,a.length-1)],r=FallingWords.CURRENT_ID+1),$(t).trigger("onSpawn",{spawn:e});var l=10,s=FallingWords.getRandomIntInRange(l,1024-l-20*e.length),d=25,c='\n    <div class="answer" data-id="'+r+'" style="left: '+s+"px; top: "+d+'px;">\n      <div class="textWrapper">\n        <p>'+e+"</p>\n      </div>\n    </div>\n    ";$("#gameView").append(c),setTimeout(function(){p()},30),o=setTimeout(function(){n()},1e3*FallingWords.SPAWN_TIME_IN_SECONDS)},p=function(){var n=$("#gameView .answer").length,t=$($("#gameView .answer")[n-1]),e=0,i=FallingWords.MAX_ROTATION/t.outerWidth()*100*FallingWords.ROTATION_MODIFIER_COEFFICIENT,a=Math.floor(FallingWords.getRandomIntInRange(-i,i));t.css({"-webkit-transform":"translate("+e+"px, "+FallingWords.MAX_Y_POSITION+"px) rotate("+a+"deg)","-moz-transform":"translate("+e+"px, "+FallingWords.MAX_Y_POSITION+"px) rotate("+a+"deg)","-o-transform":"translate("+e+"px, "+FallingWords.MAX_Y_POSITION+"px) rotate("+a+"deg)","-ms-transform":"translate("+e+"px, "+FallingWords.MAX_Y_POSITION+"px) rotate("+a+"deg)",transform:"translate("+e+"px, "+FallingWords.MAX_Y_POSITION+"px) rotate("+a+"deg)","-webkit-transition-duration":FallingWords.ANSWER_FALL_TIME+"s","transition-duration":FallingWords.ANSWER_FALL_TIME+"s","-webkit-transition-timing-function":FallingWords.EASING_FUNCTION_TO_USE,"-moz-transition-timing-function":FallingWords.EASING_FUNCTION_TO_USE,"-o-transition-timing-function":FallingWords.EASING_FUNCTION_TO_USE,"transition-timing-function":FallingWords.EASING_FUNCTION_TO_USE}),t.one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",m)},m=function(n){W($(n.target))},W=function(n){n.off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",m),n.remove()},I=function(n){n.find(".textWrapper").addClass("shake").one("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",F)},F=function n(t){$(t.currentTarget).off("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",n),$(t.currentTarget).removeClass("shake")},T=function(n){n.find(".textWrapper").addClass("scale-0 ").one("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",_)},_=function n(t){$(t.currentTarget).off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",n),W($(t.currentTarget).parent())},E=function(){l()};return t.init=function(){},t.startSpawn=function(){c()},t.stopSpawn=function(){u()},t.getQuestion=function(){return r()},t.getCorrectAnswersArray=function(){return d()},t.removeAnswer=function(n){W(n)},t.scaleAnswer=function(n){T(n)},t.shakeAnswer=function(n){I(n)},t.reset=function(){E()},t},FallingWords.GameControl=function(n){var t={},e=n.infoBar,i=n.spawnControl,a=n.feedbacView,o=n.particles,r=n.soundControl,l=n.dataHandler,s=void 0,d=void 0,c=function(){O(),e.init(),u(),g(),i.startSpawn(),f(),m(),I(),F()},u=function(){e.setQuestion({question:i.getQuestion(),color:l.getGameData()[FallingWords.CURRENT_ID].questionColor})},g=function n(){s=setTimeout(function(){u(),r.play("change"),n()},1e3*FallingWords.NEW_QUESTION_TIMER_IN_SECONDS)},f=function(){$("#gameView").on("click",E)},p=function(){$("#gameView").off("click",E)},m=function(){$(e).on("onAudioMute",T)},W=function(){$(e).off("onAudioMute",T)},I=function(){$(e).one("onEndOfTime",_)},F=function(){$(a).one("onFeedbackViewClicked",function(){c()})},T=function(n,t){r.muteAudio(t.muteAudio)},_=function(){i.stopSpawn(),W(),clearTimeout(s),a.init(e.getScore()),w()},E=function(n){if(d=$(n.target),!d.hasClass("view")){d.attr({"data-clickable":!1});var t=parseInt(d.attr("data-id")),e=d.find(".textWrapper p").text();S({answer:d,id:t,text:e})}},S=function(n){i.getCorrectAnswersArray().indexOf(n.text)===-1?v(n):R(n)},R=function(n){i.scaleAnswer(n.answer),e.incrementScore(),o.makeParticles({parent:n.answer,numberOfParticles:24,type:"sphere"})},v=function(n){i.shakeAnswer(n.answer),e.decrementScore(),n.answer.attr({"data-clickable":""})},O=function(){$("#contentWrapper").prepend('<div id="gameView" class="view"></div>')},N=function(){p(),$("#contentWrapper #gameView").remove()},w=function(){N(),i.reset(),e.reset()};return t.init=function(){c()},t},FallingWords.SoundControl=function(){var n={},t=0,e=0,i=function(n){createjs.Sound.on("fileload",a),e=Object.keys(n).length;var t=!0,i=!1,o=void 0;try{for(var r,l=Object.keys(n)[Symbol.iterator]();!(t=(r=l.next()).done);t=!0){var s=r.value;createjs.Sound.registerSound("../assets/FallingWords/audio/"+n[s]+".mp3",s)}}catch(n){i=!0,o=n}finally{try{!t&&l["return"]&&l["return"]()}finally{if(i)throw o}}},a=function(){t++,t===e&&(t=null,e=null,$(n).trigger("onAudioLoadComplete"))},o=function(n){var t=createjs.Sound.play(n);t.on("complete",r)},r=function t(e){e.target.off("complete",t),$(n).trigger("onAudioCompleted")},l=function(n){createjs.Sound.muted=n};return n.init=function(n){i(n)},n.play=function(n){o(n)},n.muteAudio=function(n){l(n)},n},FallingWords.Particles=function(n){var t={},e=n.parent||"body",i=n.numberOfParticles||1,a=n.duration||1,o=n.type||"sphere",r=["linear","ease","ease-in","ease-out"],l=function(n){e=n.parent||e,i=n.numberOfParticles||i,a=n.duration||a,o=n.type||o;for(var t="",r=0;r<i;r++){var l='<div class="particle" data-type="'+o+'"></div>';t+=l}e.append(t),setTimeout(function(){s(e)},35)},s=function(n){var t=FallingWords.getRandomInRange(.35,.7),e=r[1];n.find(".particle").each(function(n,i){var a=FallingWords.getRandomIntInRange(-FallingWords.PARTICLE_MAX_OFFSET,FallingWords.PARTICLE_MAX_OFFSET),o=FallingWords.getRandomIntInRange(-FallingWords.PARTICLE_MAX_OFFSET,FallingWords.PARTICLE_MAX_OFFSET),r=FallingWords.getRandomIntInRange(0,720),l=FallingWords.getRandomInRange(.1,.2),s=FallingWords.getRandomIntInRange(60,255),d=FallingWords.getRandomIntInRange(60,255),c=FallingWords.getRandomIntInRange(60,255);$(i).css({"-webkit-transform":"translate("+a+"px, "+o+"px) rotate("+r+"deg) scale("+l+")","-moz-transform":"translate("+a+"px, "+o+"px) rotate("+r+"deg) scale("+l+")","-o-transform":"translate("+a+"px, "+o+"px) rotate("+r+"deg) scale("+l+")","-ms-transform":"translate("+a+"px, "+o+"px) rotate("+r+"deg) scale("+l+")",transform:"translate("+a+"px, "+o+"px) rotate("+r+"deg) scale("+l+")","-webkit-transition-duration":t+"s","transition-duration":t+"s","-webkit-transition-timing-function":e,"-moz-transition-timing-function":e,"-o-transition-timing-function":e,"transition-timing-function":e,"background-color":"rgb("+s+",  "+d+", "+c+")"})})};return t.init=function(){},t.makeParticles=function(n){l(n)},t},FallingWords.Bootstrap=function(n){var t={},e=(FallingWords.ThemeControler({theme:n?n.theme:0}),FallingWords.DataHandler()),i=FallingWords.SoundControl();$(i).on("onAudioLoadComplete",function(){d.init(),FallingWords.removePreloader()});var a=FallingWords.FeedbackView({data:e.getFeedbackData()}),o=FallingWords.InfoBar({data:e.getGameViewData()}),r=FallingWords.SpawnControl({data:e.getGameData()}),l=FallingWords.Particles({parent:"#contentWrapper",numberOfParticles:10,duration:1,type:"sphere"}),s=FallingWords.GameControl({infoBar:o,spawnControl:r,feedbacView:a,particles:l,soundControl:i,dataHandler:e}),d=FallingWords.TitleView({data:e.getTitleData()});return $(d).on("onTitleViewClicked",function(){s.init()}),i.init(e.getAudioData()),t.init=function(){},t};